---
title: "Nix пакетния мениджър"
---

# Пакетни мениджъри в Linux-базирани операционни системи

## Какво е пакетен мениджър?

### Цел

Искаме да си инсталираме нови програми на машината

### Нужди

1. **Изпълним** файл
2. В **специфична** папка (директория)
3. От **коректен снабдител**

## Стандартен дизайн

### Изпълним файл

Прекомпилирани бинарки за съответната архитектура

### Специфична папка

Глобални, на едно (или няколко) от: `/bin`, `/usr/bin`, `/usr/local/bin`, `/usr/share/bin`, ...

### Коректен снабдител

Хората, поддържащи дистрибуцията

## Клопки

### Изпълним файл

- Няма бинарка за архитектурата
- Няма оптимизационни флагове за конкретния хардуер
- Създателя избира с кои фиичъри да компилира

### Специфична папка

- Само една версия на една и съща програма
- *Еднакви* версии на всички програми (не може да имаш повече от една версия на зависимостите)

### Коректен снабдител

- Случайни пичове с компютри
- Всичко идва от централизирана локация

## Решения

Изпълним файл - ние си го компилираме

Специфична папка - всяка програма и нейната версия в отделна папка

Коректен снабдител - всичко компилираме, т.е. теглим директно сорс-кодът на създателите на програмите

## Не искам да компилирам!

- Отнема много време, през което компютърът е неизползваем (100% CPU, 100% RAM utilization)
- Огромно разнообразие (главоболие) от програмни езици, компилационни toolchains, зависимости (които сами по себе си трябва да се компилират), ...
- Безброй много опции за компилиране на всеки един пакет, кой е най-добър?

- И това всеки уикенд когато си ъпдейтваме системата :)

## Решение: възпроизводима компилация

- Една версия на програма, с конкретни настройки, **винаги** да води до **една и съща бинарка**
- Ако някой вече е компилирал тази версия с тези опции, можем да изтеглим неговата бинарка. **Няма да има разлика с това да компилираме!**
- Разпространение на тези кеширани бинарки ни спестява компилация!

- Нужната среда за компилация трябва да може да се опише по някакъв еднакво възпроизводим начин.
  Нещо с възможности като един `bash` скрипт, но много по-добро.
- За да не откриваме топлата вода всеки път, трябва да може хора да ги пишат и да споделят.

## Програмите в свои папки чупят всичко!

- Практически всяко парче софтуер очаква то и неговите зависимости да се намират в `/bin`, `/usr/share/bin`, ...
- Не можем да преместим ей така!

## Решение: промяна на бинарки и PATH

- Бинарките могат да се променят, често се задават като низове
- Понякога е зададено само името на програма, и се очаква тя да е налична локално, посредством PATH променливата.
  Винаги можем да променим `PATH`.
  За да няма конфликти, тоя трябва да може да се случи локално в шел.

## Не искам да търся източниците на програмата и зависимостите!

- За големи програми, може да се наложи да знаем стотици линкове за източниците на всяко нещо!
- Освен GitHub, хората си слагат софтуера и в други платформи: GitLab, sourcehut, sourceforge, Bitbucket, Gitea, gitbucket, ...
- и някои си хостват гит репота на свой сайт: gitlab.freedesktop.org, ...

## Решение: всички си споделят списъци

- Списъците (базите данни) с всички репота могат да се споделят публично

## Мечтаният пакетен мениджър

- Компилираме си програмите
  - възпроизводимо описание на нужната среда за компилация
  - възпроизводима компилация
  - кеш на бинарки
- Програмите в уникални папки, спрямо версията, компилационни флагове и проче
  - пачване на бинарки
  - локални шелове с правилния `PATH`
- Поддържа всички възможни източници на сорс-код: GitHub, GitLab, ...
  - публична база данни с всички източници на всички програим

# Мечтите в реалност - Nix пакетния мениджър

## Как ни реализира желанията

- Възпроизводимо описание на нужната среда за компилация - Nix програмният език
- Възпроизводима компилация и кеш - в бъдеще

- Програми в уникални папки - всяко нещо в `/nix/store/XXXXXXXXXXXXXX-name-version/`
  - `XXXXXXXXXXX` е хешът на бинарката, така лесно и бързо можем да проверим дали дадена програма отговаря на нашите желания (и дали можем да я използваме като кеш)
- Локални шелове с правилния `PATH` - пускаме `bash` команда с нужните настройки

- Източници на програмите - просто ги вкарваме в описанията за среда за компилация

## Нека да го пробваме!

- Всички програми се намират в `/nix/store`, тоест можем да инсталираме Nix на **всяка машина, без това да влияе върху инсталацията на програми!**

```
sh <(curl -L https://nixos.org/nix/install) --daemon
```
